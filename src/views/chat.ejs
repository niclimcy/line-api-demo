<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="flex items-end m-0 font-sans bg-gray-50 min-h-[calc(100dvh)]">
      <div class="flex flex-col justify-end w-full">
        <div
          class="w-full mx-auto p-4 overflow-y-auto overscroll-contain max-h-[80vh]"
        >
          <ul id="messages" class="list-none m-0 p-0 space-y-4">
            <!-- Messages will appear here -->
          </ul>
        </div>
        <form
          id="form"
          action=""
          class="bg-white p-4 flex items-center space-x-4 shadow-lg"
        >
          <input
            id="input"
            autocomplete="off"
            class="border border-gray-300 rounded-full px-4 py-2 flex-grow focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Type your message..."
          />
          <button
            class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded-full focus:outline-none"
          >
            Send
          </button>
        </form>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io()
      const form = document.getElementById('form')
      const input = document.getElementById('input')
      const messages = document.getElementById('messages')

      form.addEventListener('submit', (e) => {
        e.preventDefault()
        if (input.value) {
          socket.emit('chat message', input.value)
          input.value = ''
        }
      })

      socket.on('chat message', (msg) => {
        const item = document.createElement('li')
        item.textContent = msg
        item.className =
          'p-4 rounded-lg relative max-w-3/4 bg-blue-100 self-end text-left'
        const timestamp = document.createElement('span')
        const now = new Date()
        timestamp.textContent = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`
        timestamp.className = 'text-xs text-gray-500 absolute bottom-0 right-2'
        item.appendChild(timestamp)
        messages.appendChild(item)
        window.scrollTo(0, document.body.scrollHeight)
      })
    </script>
  </body>
</html>
